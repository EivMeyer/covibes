<!DOCTYPE html>
<html>
<head>
    <title>Terminal Fix Status Checker</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>üîß Terminal Fix Status Checker</h1>
    <div id="results">Loading...</div>

    <script>
        async function checkFixStatus() {
            const results = document.getElementById('results');
            let html = '<h2>Checking Terminal Fix Status...</h2>';

            try {
                // Check if we can reach the API
                html += '<h3>1. API Connection Test</h3>';
                const healthCheck = await fetch('/api/health');
                if (healthCheck.ok) {
                    html += '<div class="pass">‚úÖ API is reachable</div>';
                } else {
                    html += '<div class="fail">‚ùå API is not reachable</div>';
                }

                // Check authentication
                html += '<h3>2. Authentication Test</h3>';
                const authCheck = await fetch('/api/auth/me');
                if (authCheck.ok) {
                    const authData = await authCheck.json();
                    html += '<div class="pass">‚úÖ Authenticated as: ' + (authData.user?.email || 'unknown') + '</div>';
                    html += '<div class="info">üîç User ID: ' + (authData.user?.id || 'unknown') + '</div>';
                } else {
                    html += '<div class="fail">‚ùå Not authenticated</div>';
                    html += '<div class="info">Please login first</div>';
                }

                // Check agents
                html += '<h3>3. Agents Data Test</h3>';
                const agentsCheck = await fetch('/api/agents');
                if (agentsCheck.ok) {
                    const agentsData = await agentsCheck.json();
                    html += '<div class="pass">‚úÖ Agents loaded: ' + (agentsData.agents?.length || 0) + '</div>';

                    if (agentsData.agents && agentsData.agents.length > 0) {
                        html += '<h4>Agent Details:</h4>';
                        agentsData.agents.forEach(agent => {
                            html += '<div class="info">';
                            html += 'ü§ñ <strong>' + (agent.agentName || agent.userName || 'Unnamed') + '</strong><br>';
                            html += '&nbsp;&nbsp;ID: ' + (agent.id || 'unknown') + '<br>';
                            html += '&nbsp;&nbsp;UserId: ' + (agent.userId || 'MISSING!') + '<br>';
                            html += '&nbsp;&nbsp;Status: ' + (agent.status || 'unknown') + '<br>';
                            html += '&nbsp;&nbsp;IsOwner: ' + (agent.isOwner || 'unknown') + '<br>';
                            html += '</div>';
                        });

                        // Find Quinn Server specifically
                        const quinnServer = agentsData.agents.find(a =>
                            (a.agentName || '').includes('Quinn') ||
                            (a.agentName || '').includes('Server')
                        );

                        if (quinnServer) {
                            html += '<h4>üéØ Quinn Server Analysis:</h4>';
                            html += '<pre>';
                            html += 'Agent: ' + (quinnServer.agentName || 'Unnamed') + '\n';
                            html += 'UserId: ' + (quinnServer.userId || 'MISSING!') + '\n';
                            html += 'Status: ' + (quinnServer.status || 'unknown') + '\n';
                            html += 'IsOwner: ' + (quinnServer.isOwner || false) + '\n';
                            html += 'CanInteract: ' + (quinnServer.isOwner && (quinnServer.status === 'running' || quinnServer.status === 'starting')) + '\n';
                            html += '</pre>';

                            if (quinnServer.userId && quinnServer.isOwner) {
                                html += '<div class="pass">‚úÖ FIX IS WORKING: Quinn Server should show as Interactive</div>';
                            } else {
                                html += '<div class="fail">‚ùå FIX NOT WORKING: Quinn Server will show as Read-only</div>';
                                if (!quinnServer.userId) {
                                    html += '<div class="fail">‚ùå PROBLEM: userId is missing from agent data</div>';
                                }
                                if (!quinnServer.isOwner) {
                                    html += '<div class="fail">‚ùå PROBLEM: isOwner is false</div>';
                                }
                            }
                        } else {
                            html += '<div class="info">üîç No Quinn Server agent found</div>';
                        }
                    }
                } else {
                    html += '<div class="fail">‚ùå Failed to load agents</div>';
                }

                // Instructions
                html += '<h3>4. Instructions</h3>';
                html += '<div class="info">';
                html += 'If the fix is working but you still see "Read-only Observer":<br>';
                html += '‚Ä¢ Try refreshing the page (Ctrl+F5)<br>';
                html += '‚Ä¢ Clear browser cache<br>';
                html += '‚Ä¢ Make sure you\'re looking at the Quinn Server terminal specifically<br>';
                html += '‚Ä¢ Check that you\'re logged in as the same user who created the agent<br>';
                html += '</div>';

            } catch (error) {
                html += '<div class="fail">‚ùå Error: ' + error.message + '</div>';
            }

            results.innerHTML = html;
        }

        // Run the check
        checkFixStatus();
    </script>
</body>
</html>